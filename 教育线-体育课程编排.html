<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>教育线体育课程编排需求说明书</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1, h2, h3, h4 {
            color: #333;
            margin-top: 1.5em;
            margin-bottom: 0.8em;
        }
        h1 { font-size: 2.2em; }
        h2 { font-size: 1.8em; }
        h3 { font-size: 1.5em; }
        h4 { font-size: 1.3em; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1em 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f5f5f5;
        }
        pre {
            background-color: #f6f8fa;
            border-radius: 6px;
            padding: 16px;
            overflow: auto;
        }
        code {
            font-family: SFMono-Regular, Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 0.9em;
        }
        img {
            max-width: 100%;
            height: auto;
        }
        .mermaid {
            margin: 1em 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>教育线体育课程编排需求说明书</h1>

    <h2>需求背景</h2>
    <p>幼儿园依据体育课程编排要求，对幼儿园的体育课程进行编排，要求如下：<br>每个班级必须安排体育课程，且体育课程的数量与班级的数量相同。排列的课程表不能存在资源冲突。系统需要支持灵活的课程编排和动态调整，同时保证资源的合理分配和使用效率。</p>

    <h2>功能需求</h2>
    <h3>功能清单</h3>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>序号</th>
                <th>功能内容</th>
                <th>优先级</th>
                <th>描述</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1</td>
                <td>排课功能</td>
                <td>P0</td>
                <td>支持全园和单班级两种模式的课程编排</td>
            </tr>
            <tr>
                <td>2</td>
                <td>资源冲突管理</td>
                <td>P0</td>
                <td>实时检测和预防资源冲突，提供解决方案</td>
            </tr>
        </tbody>
    </table>

    <h2>课程编排的数据范围是幼儿园圈选的最新课程数据</h2>
    <img src="image/教育线-体育课程编排/1743644997225.png" alt="课程编排数据范围图">

    <h3>业务流程图</h3>
    <div class="mermaid">
flowchart TD
    A[业务应用端] -->|存储课程信息| E[(SR数据库)]
    A -->|提交课程编排请求| B[专家管理平台]
    B -->|组装业务信息| C[全域数据平台]
    C -->|传输基础参数| D[算法模型]
    D -->|获取课程信息| E
    D -->|内部计算处理|D
    D -->|返回课程内容| C
    C -->|异步存储| E
    C -->|返回数据| B
    B -->|异步存储| F[(专家数据库)]
    B -->|返回数据| A
    A -->|显示数据| G[前端展示]
  
    subgraph 课程信息存储
    H1[班级信息]
    I1[训练信息]
    J1[器械信息]
    end

    subgraph 业务基础参数
    H[班级信息]
    I[班级数量信息]
    L[业务线信息]
    K[计划周期]
    N[资源冲突信息]
    M[群体运动目标]
    end
    </div>

    <h4>系统时序图</h4>
    <div class="mermaid">
sequenceDiagram
    participant A as 业务应用端
    participant B as 专家管理平台
    participant C as 全域数据平台
    participant D as 算法模型
    participant E as SR数据库
    participant F as 专家数据库

    A->>E: 存储可用课程信息
    Note over A,E: 包含班级信息、训练信息和器械信息
    A->>B: 提交课程编排请求
    Note over A,B: 包含业务基础参数
    B->>C: 组装并传输业务信息
    Note over B,C: 包含计划周期等基础数据
    C->>D: 传输业务参数
    D->>E: 获取可用课程信息
    Note over D,E: 算法自主获取已存储的课程数据
    D-->>D: 内部计算处理
    Note over D: 基于获取的数据进行排课计算
    D->>C: 返回课程编排结果
    C->>E: 异步存储数据
    C->>B: 返回处理结果
    B->>F: 异步存储数据
    B->>A: 返回课程编排数据
    A->>A: 前端展示
    </div>

    <h3>数据字典</h3>
    <ol>
        <li>
            <p>业务线信息</p>
            <ul>
                <li>business_line_id: 业务线唯一标识</li>
                <li>business_line_name: 业务线名称</li>
                <li>business_type: 业务类型（体育课程）</li>
                <li>status: 状态（活动/禁用）</li>
            </ul>
        </li>
        <li>
            <p>班级信息</p>
            <ul>
                <li>class_id: 班级唯一标识</li>
                <li>grade_type: 年级类型（大班/中班/小班）</li>
                <li>class_name: 班级名称</li>
                <li>student_count: 学生数量</li>
                <li>head_teacher: 班主任信息</li>
            </ul>
        </li>
        <li>
            <p>课程信息</p>
            <ul>
                <li>course_scope_id: 课程范围唯一标识</li>
                <li>business_line_id: 关联的业务线ID</li>
                <li>scope_name: 课程范围名称</li>
                <li>grade_type: 适用年级（大班/中班/小班）</li>
                <li>training_categories: 训练类别列表</li>
            </ul>
        </li>
        <li>
            <p>训练类别映射</p>
            <ul>
                <li>小班：
                    <ul>
                        <li>类型：基础能力</li>
                        <li>项目：[灵活性、稳定性、协调性、敏捷性、平衡性、反应性]</li>
                    </ul>
                </li>
                <li>中班：
                    <ul>
                        <li>类型：动作模式</li>
                        <li>项目：[蹲、弓步、弯、转、走、提拉、推、举、爬、翻]</li>
                    </ul>
                </li>
                <li>大班：
                    <ul>
                        <li>类型：能力提升</li>
                        <li>项目：[敏捷、反应、柔韧、力量、速度、协调、爆发、平衡]</li>
                    </ul>
                </li>
            </ul>
        </li>
        <li>
            <p>器械信息</p>
            <ul>
                <li>equipment_id: 器械唯一标识</li>
                <li>equipment_name: 器械名称</li>
                <li>equipment_type: 器械类型（器械、器材）</li>
                <li>equipment_count: 器械数量</li>
                <li>equipment_status: 器械状态（可用/不可用）</li>
            </ul>
        </li>
        <li>
            <p>资源冲突信息</p>
            <ul>
                <li>conflict_id: 冲突唯一标识</li>
                <li>conflict_type: 冲突类型（教师/场地/器械）</li>
                <li>conflict_info: 冲突信息（教师ID/场地ID/器械ID）</li>
                <li>conflict_resolution: 冲突解决方案（人工/自动）</li>
            </ul>
        </li>
        <li>
            <p>群体运动目标</p>
            <ul>
                <li>target_id: 目标唯一标识</li>
                <li>target_type: 目标类型（能力提升/灵活性/稳定性/协调性/敏捷性/平衡性/反应性）</li>
                <li>target_value: 目标值</li>
            </ul>
        </li>
    </ol>

    <h2>数据模型</h2>
    <h3>排课功能：面向全园生成运动课程</h3>

    <h4>模型入参</h4>
    <ul>
        <li>班级信息：年级和班级信息</li>
        <li>课程信息：已排课程信息</li>
        <li>业务线信息：业务线信息</li>
    </ul>

    <h4>约束条件</h4>
    <ol>
        <li>
            <p>课程目标</p>
            <ul>
                <li>在初始化的运动目标基础上，选择的运动类别，增加+2个运动课时</li>
            </ul>
        </li>
        <li>
            <p>计划周期</p>
            <ul>
                <li>计划周期是并的关系</li>
                <li>正常上课时间内，一个自然日安排两次体育课程</li>
            </ul>
        </li>
        <li>
            <p>老师资源</p>
            <ul>
                <li>输入老师和其对应的授课年级</li>
                <li>老师资源在统一时间内只能安排一个老师上课</li>
                <li>教师每个工作日的工作时间为8小时</li>
            </ul>
        </li>
        <li>
            <p>场地资源</p>
            <ul>
                <li>输入场地和允许使用数量</li>
                <li>场地在统一时间内只能安排一个课程使用</li>
                <li>场地可使用时间不限</li>
            </ul>
        </li>
        <li>
            <p>器械资源</p>
            <ul>
                <li>输入器械和允许使用数量</li>
                <li>一节课程允许使用多种器械</li>
                <li>器械可使用时间不限</li>
            </ul>
        </li>
        <li>
            <p>课程资源</p>
            <ul>
                <li>正常上课时间内，一个自然日安排两次体育课程</li>
                <li>园区已经圈选的课程</li>
            </ul>
        </li>
    </ol>

    <h4>目标函数</h4>
    <ol>
        <li>
            <p>课程目标</p>
            <ul>
                <li>课程的安排满足目标的维度要求</li>
                <li>课程的安排满足目标的数量要求</li>
            </ul>
        </li>
        <li>
            <p>最大化课程覆盖率</p>
            <ul>
                <li>确保所有班级都能按要求安排体育课程</li>
                <li>确保每个训练类别在计划周期内得到合理分配</li>
            </ul>
        </li>
        <li>
            <p>最小化资源冲突</p>
            <ul>
                <li>教师资源不冲突</li>
                <li>场地资源不冲突</li>
                <li>最小化器械资源冲突</li>
            </ul>
        </li>
        <li>
            <p>最优化课程分布</p>
            <ul>
                <li>保证课程时间分布均匀性</li>
                <li>确保不同训练类别的合理间隔</li>
                <li>优化各年级课程的时间分配</li>
            </ul>
        </li>
    </ol>

    <h4>模型输出</h4>
    <p>课程表格式：</p>
    <pre><code class="language-json">{
  "schedule_id": "unique_id",
  "class_schedules": [
    {
      "date": "2024-01-01",
      "time_slot": "上午",
      "class_info": {
        "grade": "大班",
        "class_name": "大班1班"
      },
      "course_info": {
        "training_type": "能力提升",
        "training_item": "敏捷"
      },
      "resources": {
        "teacher": "张老师",
        "venue": "室外操场",
        "equipment": ["跳绳", "雪糕桶"]
      }
    }
  ]
}</code></pre>

    <h4>模型评估</h4>
    <ol>
        <li>
            <p>合规性检查</p>
            <ul>
                <li>检查每个班级的课程数量是否满足运动目标要求</li>
                <li>验证训练类别是否符合年级对应关系</li>
                <li>确认资源分配是否存在冲突</li>
            </ul>
        </li>
        <li>
            <p>均衡性评估</p>
            <ul>
                <li>评估课程时间分布的均匀程度</li>
                <li>计算各类训练项目的分配比例</li>
                <li>分析资源利用率</li>
            </ul>
        </li>
        <li>
            <p>资源利用率</p>
            <ul>
                <li>分析资源利用率</li>
            </ul>
        </li>
        <li>
            <p>质量评分</p>
            <p>得分 = w1*合规性得分 + w2*均衡性得分 + w3*资源利用率得分<br>
            其中：w1 = 0.4, w2 = 0.3, w3 = 0.3</p>

            <p>a. 合规性得分（0-100分）</p>
            <ul>
                <li>基础规则：初始分100分，违反一条约束扣10分</li>
                <li>检查清单：
                    <ul>
                        <li>班级课程数量是否符合要求（-10分/个）</li>
                        <li>训练类别是否符合年级对应关系（-10分/个）</li>
                    </ul>
                </li>
            </ul>

            <p>b. 均衡性得分（0-100分）</p>
            <ul>
                <li>时间分布评分（50分）：
                    <ul>
                        <li>计算所有课程时间间隔的标准差(σ)</li>
                        <li>标准差分数 = 50 * (1 - σ/最大可能标准差)</li>
                    </ul>
                </li>
                <li>训练类别分布评分（50分）：
                    <ul>
                        <li>计算各训练类别出现频率与理想均匀分布的偏差</li>
                        <li>偏差率 = 实际偏差/最大可能偏差</li>
                        <li>分数 = 50 * (1 - 偏差率)</li>
                    </ul>
                </li>
            </ul>

            <p>c. 资源利用率得分（0-100分）</p>
            <ul>
                <li>教师资源利用率（40分）：
                    <ul>
                        <li>实际授课时长/可用时长 * 40</li>
                        <li>可用时长计算：每位老师每个工作日的标准工作时间（8小时）乘以工作日天数</li>
                    </ul>
                </li>
                <li>场地资源利用率（30分）：
                    <ul>
                        <li>实际使用时长/可用时长 * 30</li>
                        <li>可用时长计算：同老师工作时间</li>
                    </ul>
                </li>
                <li>器械资源利用率（30分）：
                    <ul>
                        <li>平均使用率 = Σ(各器械使用时长/可用时长)/器械总数</li>
                        <li>分数 = 平均使用率 * 30</li>
                        <li>可用时长计算：同老师工作时间</li>
                    </ul>
                </li>
            </ul>
        </li>
        <li>
            <p>特殊规则</p>
            <p>如果发生以下情况，直接整体分数为50分：</p>
            <ul>
                <li>教师资源冲突</li>
                <li>场地资源冲突</li>
            </ul>
        </li>
        <li>
            <p>判定标准</p>
            <ul>
                <li>优秀：总分 ≥ 90</li>
                <li>良好：75 ≤ 总分 < 90</li>
                <li>合格：60 ≤ 总分 < 75</li>
                <li>不合格：总分 < 60</li>
                <li>不合格：人员冲突、场地冲突总分数 < 60</li>
                <li>合格以上内容，直接进行输出</li>
            </ul>
        </li>
    </ol>

    <h3>生成计划：面向某个班级生成运动课程</h3>

    <h4>模型入参</h4>
    <ul>
        <li>班级信息：年级和班级信息</li>
        <li>课程信息：已排课程信息</li>
        <li>业务线信息：业务线信息</li>
    </ul>

    <h4>约束条件</h4>
    <ol>
        <li>
            <p>课程目标</p>
            <ul>
                <li>在初始化的运动目标基础上，选择的运动类别，增加+2个运动课时</li>
            </ul>
        </li>
        <li>
            <p>计划周期</p>
            <ul>
                <li>计划周期是并的关系</li>
                <li>正常上课时间内，一个自然日安排两次体育课程</li>
            </ul>
        </li>
        <li>
            <p>课程资源</p>
            <ul>
                <li>正常上课时间内，一个自然日安排两次体育课程</li>
            </ul>
        </li>
    </ol>

    <h4>目标函数</h4>
    <ol>
        <li>
            <p>课程目标</p>
            <ul>
                <li>课程的安排满足目标的维度要求</li>
                <li>课程的安排满足目标的数量要求</li>
            </ul>
        </li>
        <li>
            <p>最大化课程覆盖率</p>
            <ul>
                <li>确保所有班级都能按要求安排体育课程</li>
                <li>确保每个训练类别在计划周期内得到合理分配</li>
            </ul>
        </li>
        <li>
            <p>最优化课程分布</p>
            <ul>
                <li>保证课程时间分布均匀性</li>
                <li>确保不同训练类别的合理间隔</li>
                <li>优化各年级课程的时间分配</li>
            </ul>
        </li>
    </ol>

    <h4>模型输出</h4>
    <p>课程表格式：</p>
    <pre><code class="language-json">{
  "schedule_id": "unique_id",
  "class_schedules": [
    {
      "date": "2024-01-01",
      "time_slot": "上午",
      "class_info": {
        "grade": "大班",
        "class_name": "大班1班"
      },
      "course_info": {
        "training_type": "能力提升",
        "training_item": "敏捷"
      },
      "resources": {
        "teacher": "",
        "venue": "",
        "equipment": ["跳绳", "雪糕桶"]
      }
    }
  ]
}</code></pre>

    <h4>模型评估</h4>
    <p>评估标准与全园生成运动课程相同。</p>

    <h2>非功能性需求</h2>

    <h3>性能需求</h3>
    <ul>
        <li>系统响应时间：普通操作响应时间<5秒，复杂排课计算<10秒</li>
        <li>并发处理能力：支持100个用户同时操作</li>
        <li>数据处理能力：支持1000个班级的同时排课</li>
    </ul>

    <h3>可扩展性需求</h3>
    <ul>
        <li>支持新增课程类型和评分规则</li>
        <li>支持自定义资源类型和约束条件</li>
    </ul>

    <h3>系统异常处理</h3>
    <ol>
        <li>
            <p>数据验证错误</p>
            <ul>
                <li>输入参数校验失败</li>
                <li>数据格式不符合要求</li>
                <li>处理方式：返回具体错误信息，提示用户修正</li>
            </ul>
        </li>
        <li>
            <p>业务逻辑错误</p>
            <ul>
                <li>资源冲突无法解决</li>
                <li>课程编排不满足约束条件</li>
                <li>处理方式：提供可选的解决方案，允许人工介入</li>
            </ul>
        </li>
        <li>
            <p>系统运行错误</p>
            <ul>
                <li>服务器响应超时</li>
                <li>数据库连接失败</li>
                <li>处理方式：自动重试，失败后通知系统管理员</li>
            </ul>
        </li>
    </ol>

    <h3>数据同步机制</h3>
    <ol>
        <li>
            <p>实时同步</p>
            <ul>
                <li>课程编排结果</li>
                <li>资源分配状态</li>
                <li>同步方式：消息队列推送</li>
            </ul>
        </li>
    </ol>

    <h3>数据一致性保证</h3>
    <ol>
        <li>
            <p>状态管理</p>
            <ul>
                <li>课程状态流转</li>
                <li>资源状态变更</li>
                <li>保证方式：状态机制</li>
            </ul>
        </li>
    </ol>

    <script>
        mermaid.initialize({ startOnLoad: true });
        hljs.highlightAll();
    </script>
</body>
</html>